<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>P2P Call App</title>
  <style>
    body { background: black; color: #00ff00; font-family: monospace; text-align: center; padding: 20px; }
    .btn { background: #003300; border: 1px solid #00ff00; padding: 10px 20px; color: #00ff00; cursor: pointer; margin: 5px; border-radius: 8px; }
    .btn:hover { background: #00ff00; color: black; }
    #popup { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: black; border: 1px solid #00ff00; padding: 10px; display: none; color: #00ff00; }
  </style>
</head>
<body>
  <h2>ðŸ”— P2P Call Hacker Style</h2>
  <p>Your Temp Number: <span id="my-number"></span></p>
  <input id="callto" placeholder="Enter number to call" />
  <button class="btn" onclick="makeCall()">Call</button>
  <br/><br/>
  <button class="btn" id="endCallBtn" onclick="endCall()" disabled>End Call</button>
  <button class="btn" id="muteBtn" onclick="toggleMute()" disabled>Mute</button>
  <button class="btn" id="speakerBtn" onclick="toggleSpeaker()" disabled>Speaker</button>
  <p id="timer">Call Time: 00:00</p>
  <div id="popup"></div>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const myNumber = "9957" + Math.floor(100000 + Math.random() * 900000);
    document.getElementById('my-number').innerText = myNumber;
    const peer = new Peer(myNumber, {
      host: "REPLACE_WITH_RENDER_URL",
      port: 443,
      path: "/"
    });
    let localStream, currentCall, callTimer, seconds = 0;
    function showPopup(msg) {
      const popup = document.getElementById('popup');
      popup.innerText = msg;
      popup.style.display = 'block';
      setTimeout(()=>{ popup.style.display='none'; },2000);
    }
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => { localStream = stream; });
    peer.on('call', call => {
      showPopup("Incoming Call...");
      call.answer(localStream);
      call.on('stream', remoteStream => { playRemote(remoteStream); });
      currentCall = call; startTimer();
      enableButtons();
    });
    function makeCall() {
      const num = document.getElementById('callto').value;
      if(!num) return;
      showPopup("Calling " + num + "...");
      const call = peer.call(num, localStream);
      call.on('stream', remoteStream => { playRemote(remoteStream); });
      call.on('close', ()=>{ endCall(); });
      currentCall = call; startTimer();
      enableButtons();
    }
    function playRemote(stream) {
      const audio = document.createElement('audio');
      audio.srcObject = stream;
      audio.autoplay = true;
      audio.id = "remoteAudio";
      document.body.appendChild(audio);
    }
    function endCall() {
      if(currentCall) currentCall.close();
      showPopup("Call Ended");
      clearInterval(callTimer);
      seconds=0; document.getElementById('timer').innerText="Call Time: 00:00";
      disableButtons();
    }
    function toggleMute() {
      localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
      showPopup(localStream.getAudioTracks()[0].enabled ? "Unmuted" : "Muted");
    }
    function toggleSpeaker() {
      const audio = document.getElementById("remoteAudio");
      if(audio) {
        audio.muted = !audio.muted;
        showPopup(audio.muted ? "Speaker Off" : "Speaker On");
      }
    }
    function startTimer() {
      clearInterval(callTimer);
      callTimer = setInterval(()=>{
        seconds++;
        const m = String(Math.floor(seconds/60)).padStart(2,'0');
        const s = String(seconds%60).padStart(2,'0');
        document.getElementById('timer').innerText = `Call Time: ${m}:${s}`;
      },1000);
    }
    function enableButtons(){
      document.getElementById('endCallBtn').disabled=false;
      document.getElementById('muteBtn').disabled=false;
      document.getElementById('speakerBtn').disabled=false;
    }
    function disableButtons(){
      document.getElementById('endCallBtn').disabled=true;
      document.getElementById('muteBtn').disabled=true;
      document.getElementById('speakerBtn').disabled=true;
    }
  </script>
</body>
</html>
